//
//  PBRPass.cpp
//  PBRLib
//
//  Created by Асиф Мамедов on 19/07/2020.
//  Copyright © 2020 Асиф Мамедов. All rights reserved.
//

#include "PBRPass.hpp"

#include "../../VulkanWrapper/PhysicalDevice.hpp"

#include "../../VulkanWrapper/ComputePipeline.hpp"
#include "../../VulkanWrapper/ShaderModule.hpp"
#include "../../VulkanWrapper/PipelineLayout.hpp"
#include "../../VulkanWrapper/DescriptorSet.hpp"

#include "../../VulkanWrapper/CommandBuffer.hpp"

#include "../../VulkanWrapper/Image.hpp"

#include "../../Camera/CameraBase.hpp"

using vec3 = pbrlib::math::Vec3<float>;
using vec4 = pbrlib::math::Vec4<float>;

#include "../Shaders/PointLightData.h"
#include "../Shaders/SpotLightData.h"
#include "../Shaders/DirectionLightData.h"
#include "../Shaders/NumLights.h"

#include "../Shaders/CameraData.h"

#include "../../../Util/enumCast.hpp"

////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
namespace pbrlib
{   
    static const uint8_t pbrpass_comp_spirv[] = 
    {
        0x03, 0x02, 0x23, 0x07, 0x00, 0x00, 0x01, 0x00, 0x07, 0x00, 0x08, 0x00, 0x5f, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x11, 0x00, 0x02, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0b, 0x00, 0x06, 0x00,
        0x01, 0x00, 0x00, 0x00, 0x47, 0x4c, 0x53, 0x4c, 0x2e, 0x73, 0x74, 0x64, 0x2e, 0x34, 0x35, 0x30,
        0x00, 0x00, 0x00, 0x00, 0x0e, 0x00, 0x03, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
        0x0f, 0x00, 0x06, 0x00, 0x05, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x6d, 0x61, 0x69, 0x6e,
        0x00, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x10, 0x00, 0x06, 0x00, 0x04, 0x00, 0x00, 0x00,
        0x11, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
        0x03, 0x00, 0x03, 0x00, 0x02, 0x00, 0x00, 0x00, 0xc2, 0x01, 0x00, 0x00, 0x04, 0x00, 0x0a, 0x00,
        0x47, 0x4c, 0x5f, 0x47, 0x4f, 0x4f, 0x47, 0x4c, 0x45, 0x5f, 0x63, 0x70, 0x70, 0x5f, 0x73, 0x74,
        0x79, 0x6c, 0x65, 0x5f, 0x6c, 0x69, 0x6e, 0x65, 0x5f, 0x64, 0x69, 0x72, 0x65, 0x63, 0x74, 0x69,
        0x76, 0x65, 0x00, 0x00, 0x04, 0x00, 0x08, 0x00, 0x47, 0x4c, 0x5f, 0x47, 0x4f, 0x4f, 0x47, 0x4c,
        0x45, 0x5f, 0x69, 0x6e, 0x63, 0x6c, 0x75, 0x64, 0x65, 0x5f, 0x64, 0x69, 0x72, 0x65, 0x63, 0x74,
        0x69, 0x76, 0x65, 0x00, 0x05, 0x00, 0x04, 0x00, 0x04, 0x00, 0x00, 0x00, 0x6d, 0x61, 0x69, 0x6e,
        0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x03, 0x00, 0x09, 0x00, 0x00, 0x00, 0x75, 0x76, 0x00, 0x00,
        0x05, 0x00, 0x08, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x67, 0x6c, 0x5f, 0x47, 0x6c, 0x6f, 0x62, 0x61,
        0x6c, 0x49, 0x6e, 0x76, 0x6f, 0x63, 0x61, 0x74, 0x69, 0x6f, 0x6e, 0x49, 0x44, 0x00, 0x00, 0x00,
        0x05, 0x00, 0x04, 0x00, 0x15, 0x00, 0x00, 0x00, 0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x00, 0x00, 0x00,
        0x05, 0x00, 0x05, 0x00, 0x19, 0x00, 0x00, 0x00, 0x41, 0x6e, 0x69, 0x73, 0x6f, 0x74, 0x72, 0x6f,
        0x70, 0x79, 0x00, 0x00, 0x05, 0x00, 0x04, 0x00, 0x22, 0x00, 0x00, 0x00, 0x6e, 0x6f, 0x72, 0x6d,
        0x61, 0x6c, 0x00, 0x00, 0x05, 0x00, 0x07, 0x00, 0x23, 0x00, 0x00, 0x00, 0x4e, 0x6f, 0x72, 0x6d,
        0x61, 0x6c, 0x41, 0x6e, 0x64, 0x52, 0x6f, 0x75, 0x67, 0x68, 0x6e, 0x65, 0x73, 0x73, 0x00, 0x00,
        0x05, 0x00, 0x03, 0x00, 0x29, 0x00, 0x00, 0x00, 0x70, 0x6f, 0x73, 0x00, 0x05, 0x00, 0x07, 0x00,
        0x2a, 0x00, 0x00, 0x00, 0x50, 0x6f, 0x73, 0x69, 0x74, 0x69, 0x6f, 0x6e, 0x41, 0x6e, 0x64, 0x4d,
        0x65, 0x74, 0x61, 0x6c, 0x6c, 0x69, 0x63, 0x00, 0x05, 0x00, 0x06, 0x00, 0x30, 0x00, 0x00, 0x00,
        0x64, 0x69, 0x72, 0x5f, 0x74, 0x6f, 0x5f, 0x63, 0x61, 0x6d, 0x65, 0x72, 0x61, 0x00, 0x00, 0x00,
        0x05, 0x00, 0x05, 0x00, 0x31, 0x00, 0x00, 0x00, 0x43, 0x61, 0x6d, 0x65, 0x72, 0x61, 0x44, 0x61,
        0x74, 0x61, 0x00, 0x00, 0x06, 0x00, 0x06, 0x00, 0x31, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x70, 0x6f, 0x73, 0x69, 0x74, 0x69, 0x6f, 0x6e, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x06, 0x00,
        0x32, 0x00, 0x00, 0x00, 0x75, 0x5f, 0x63, 0x61, 0x6d, 0x65, 0x72, 0x61, 0x5f, 0x64, 0x61, 0x74,
        0x61, 0x00, 0x00, 0x00, 0x06, 0x00, 0x05, 0x00, 0x32, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x64, 0x61, 0x74, 0x61, 0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x05, 0x00, 0x34, 0x00, 0x00, 0x00,
        0x63, 0x61, 0x6d, 0x65, 0x72, 0x61, 0x5f, 0x64, 0x61, 0x74, 0x61, 0x00, 0x05, 0x00, 0x05, 0x00,
        0x3c, 0x00, 0x00, 0x00, 0x63, 0x6f, 0x73, 0x5f, 0x74, 0x68, 0x65, 0x74, 0x61, 0x00, 0x00, 0x00,
        0x05, 0x00, 0x05, 0x00, 0x44, 0x00, 0x00, 0x00, 0x4f, 0x75, 0x74, 0x49, 0x6d, 0x61, 0x67, 0x65,
        0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x07, 0x00, 0x4b, 0x00, 0x00, 0x00, 0x41, 0x6c, 0x62, 0x65,
        0x64, 0x6f, 0x41, 0x6e, 0x64, 0x42, 0x61, 0x6b, 0x65, 0x64, 0x41, 0x4f, 0x00, 0x00, 0x00, 0x00,
        0x05, 0x00, 0x05, 0x00, 0x4c, 0x00, 0x00, 0x00, 0x4e, 0x75, 0x6d, 0x4c, 0x69, 0x67, 0x68, 0x74,
        0x73, 0x00, 0x00, 0x00, 0x06, 0x00, 0x05, 0x00, 0x4c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x70, 0x6f, 0x69, 0x6e, 0x74, 0x00, 0x00, 0x00, 0x06, 0x00, 0x05, 0x00, 0x4c, 0x00, 0x00, 0x00,
        0x01, 0x00, 0x00, 0x00, 0x73, 0x70, 0x6f, 0x74, 0x00, 0x00, 0x00, 0x00, 0x06, 0x00, 0x05, 0x00,
        0x4c, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x64, 0x69, 0x72, 0x65, 0x63, 0x74, 0x00, 0x00,
        0x05, 0x00, 0x06, 0x00, 0x4d, 0x00, 0x00, 0x00, 0x75, 0x5f, 0x6e, 0x75, 0x6d, 0x5f, 0x6c, 0x69,
        0x67, 0x68, 0x74, 0x73, 0x00, 0x00, 0x00, 0x00, 0x06, 0x00, 0x05, 0x00, 0x4d, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x6c, 0x69, 0x67, 0x68, 0x74, 0x73, 0x00, 0x00, 0x05, 0x00, 0x05, 0x00,
        0x4f, 0x00, 0x00, 0x00, 0x6e, 0x75, 0x6d, 0x5f, 0x6c, 0x69, 0x67, 0x68, 0x74, 0x73, 0x00, 0x00,
        0x05, 0x00, 0x06, 0x00, 0x50, 0x00, 0x00, 0x00, 0x50, 0x6f, 0x69, 0x6e, 0x74, 0x4c, 0x69, 0x67,
        0x68, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x00, 0x06, 0x00, 0x06, 0x00, 0x50, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x70, 0x6f, 0x73, 0x69, 0x74, 0x69, 0x6f, 0x6e, 0x00, 0x00, 0x00, 0x00,
        0x06, 0x00, 0x08, 0x00, 0x50, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x63, 0x6f, 0x6c, 0x6f,
        0x72, 0x5f, 0x61, 0x6e, 0x64, 0x5f, 0x69, 0x6e, 0x74, 0x65, 0x6e, 0x73, 0x69, 0x74, 0x79, 0x00,
        0x05, 0x00, 0x07, 0x00, 0x52, 0x00, 0x00, 0x00, 0x75, 0x5f, 0x70, 0x6f, 0x69, 0x6e, 0x74, 0x5f,
        0x6c, 0x69, 0x67, 0x68, 0x74, 0x5f, 0x64, 0x61, 0x74, 0x65, 0x73, 0x00, 0x06, 0x00, 0x05, 0x00,
        0x52, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x64, 0x61, 0x74, 0x61, 0x00, 0x00, 0x00, 0x00,
        0x05, 0x00, 0x07, 0x00, 0x54, 0x00, 0x00, 0x00, 0x70, 0x6f, 0x69, 0x6e, 0x74, 0x5f, 0x6c, 0x69,
        0x67, 0x68, 0x74, 0x73, 0x5f, 0x64, 0x61, 0x74, 0x61, 0x00, 0x00, 0x00, 0x05, 0x00, 0x06, 0x00,
        0x55, 0x00, 0x00, 0x00, 0x53, 0x70, 0x6f, 0x74, 0x4c, 0x69, 0x67, 0x68, 0x74, 0x44, 0x61, 0x74,
        0x61, 0x00, 0x00, 0x00, 0x06, 0x00, 0x0a, 0x00, 0x55, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x70, 0x6f, 0x73, 0x69, 0x74, 0x69, 0x6f, 0x6e, 0x5f, 0x61, 0x6e, 0x64, 0x5f, 0x69, 0x6e, 0x6e,
        0x65, 0x72, 0x5f, 0x72, 0x61, 0x64, 0x69, 0x75, 0x73, 0x00, 0x00, 0x00, 0x06, 0x00, 0x0a, 0x00,
        0x55, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x64, 0x69, 0x72, 0x65, 0x63, 0x74, 0x69, 0x6f,
        0x6e, 0x5f, 0x61, 0x6e, 0x64, 0x5f, 0x6f, 0x75, 0x74, 0x65, 0x72, 0x5f, 0x72, 0x61, 0x64, 0x69,
        0x75, 0x73, 0x00, 0x00, 0x06, 0x00, 0x08, 0x00, 0x55, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00,
        0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x5f, 0x61, 0x6e, 0x64, 0x5f, 0x69, 0x6e, 0x74, 0x65, 0x6e, 0x73,
        0x69, 0x74, 0x79, 0x00, 0x05, 0x00, 0x07, 0x00, 0x57, 0x00, 0x00, 0x00, 0x75, 0x5f, 0x73, 0x70,
        0x6f, 0x74, 0x5f, 0x6c, 0x69, 0x67, 0x68, 0x74, 0x5f, 0x64, 0x61, 0x74, 0x65, 0x73, 0x00, 0x00,
        0x06, 0x00, 0x05, 0x00, 0x57, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x64, 0x61, 0x74, 0x61,
        0x00, 0x00, 0x00, 0x00, 0x05, 0x00, 0x07, 0x00, 0x59, 0x00, 0x00, 0x00, 0x73, 0x70, 0x6f, 0x74,
        0x5f, 0x6c, 0x69, 0x67, 0x68, 0x74, 0x73, 0x5f, 0x64, 0x61, 0x74, 0x61, 0x00, 0x00, 0x00, 0x00,
        0x05, 0x00, 0x07, 0x00, 0x5a, 0x00, 0x00, 0x00, 0x44, 0x69, 0x72, 0x65, 0x63, 0x74, 0x69, 0x6f,
        0x6e, 0x4c, 0x69, 0x67, 0x68, 0x74, 0x44, 0x61, 0x74, 0x61, 0x00, 0x00, 0x06, 0x00, 0x08, 0x00,
        0x5a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x64, 0x69, 0x72, 0x65, 0x63, 0x74, 0x69, 0x6f,
        0x6e, 0x5f, 0x6f, 0x6e, 0x5f, 0x6c, 0x69, 0x67, 0x68, 0x74, 0x00, 0x00, 0x06, 0x00, 0x08, 0x00,
        0x5a, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x63, 0x6f, 0x6c, 0x6f, 0x72, 0x5f, 0x61, 0x6e,
        0x64, 0x5f, 0x69, 0x6e, 0x74, 0x65, 0x6e, 0x73, 0x69, 0x74, 0x79, 0x00, 0x05, 0x00, 0x08, 0x00,
        0x5c, 0x00, 0x00, 0x00, 0x75, 0x5f, 0x64, 0x69, 0x72, 0x65, 0x63, 0x74, 0x69, 0x6f, 0x6e, 0x5f,
        0x6c, 0x69, 0x67, 0x68, 0x74, 0x5f, 0x64, 0x61, 0x74, 0x65, 0x73, 0x00, 0x06, 0x00, 0x05, 0x00,
        0x5c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x64, 0x61, 0x74, 0x61, 0x00, 0x00, 0x00, 0x00,
        0x05, 0x00, 0x08, 0x00, 0x5e, 0x00, 0x00, 0x00, 0x64, 0x69, 0x72, 0x65, 0x63, 0x74, 0x69, 0x6f,
        0x6e, 0x5f, 0x6c, 0x69, 0x67, 0x68, 0x74, 0x73, 0x5f, 0x64, 0x61, 0x74, 0x65, 0x73, 0x00, 0x00,
        0x47, 0x00, 0x04, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x0b, 0x00, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00,
        0x47, 0x00, 0x04, 0x00, 0x19, 0x00, 0x00, 0x00, 0x22, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x47, 0x00, 0x04, 0x00, 0x19, 0x00, 0x00, 0x00, 0x21, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00,
        0x47, 0x00, 0x04, 0x00, 0x23, 0x00, 0x00, 0x00, 0x22, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x47, 0x00, 0x04, 0x00, 0x23, 0x00, 0x00, 0x00, 0x21, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00,
        0x47, 0x00, 0x04, 0x00, 0x2a, 0x00, 0x00, 0x00, 0x22, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x47, 0x00, 0x04, 0x00, 0x2a, 0x00, 0x00, 0x00, 0x21, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
        0x48, 0x00, 0x05, 0x00, 0x31, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x23, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x48, 0x00, 0x05, 0x00, 0x32, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x23, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x47, 0x00, 0x03, 0x00, 0x32, 0x00, 0x00, 0x00,
        0x02, 0x00, 0x00, 0x00, 0x47, 0x00, 0x04, 0x00, 0x34, 0x00, 0x00, 0x00, 0x22, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x47, 0x00, 0x04, 0x00, 0x34, 0x00, 0x00, 0x00, 0x21, 0x00, 0x00, 0x00,
        0x09, 0x00, 0x00, 0x00, 0x47, 0x00, 0x04, 0x00, 0x44, 0x00, 0x00, 0x00, 0x22, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x47, 0x00, 0x04, 0x00, 0x44, 0x00, 0x00, 0x00, 0x21, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x47, 0x00, 0x03, 0x00, 0x44, 0x00, 0x00, 0x00, 0x19, 0x00, 0x00, 0x00,
        0x47, 0x00, 0x04, 0x00, 0x4a, 0x00, 0x00, 0x00, 0x0b, 0x00, 0x00, 0x00, 0x19, 0x00, 0x00, 0x00,
        0x47, 0x00, 0x04, 0x00, 0x4b, 0x00, 0x00, 0x00, 0x22, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x47, 0x00, 0x04, 0x00, 0x4b, 0x00, 0x00, 0x00, 0x21, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00,
        0x48, 0x00, 0x05, 0x00, 0x4c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x23, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x48, 0x00, 0x05, 0x00, 0x4c, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
        0x23, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x48, 0x00, 0x05, 0x00, 0x4c, 0x00, 0x00, 0x00,
        0x02, 0x00, 0x00, 0x00, 0x23, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x48, 0x00, 0x05, 0x00,
        0x4d, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x23, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x47, 0x00, 0x03, 0x00, 0x4d, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x47, 0x00, 0x04, 0x00,
        0x4f, 0x00, 0x00, 0x00, 0x22, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x47, 0x00, 0x04, 0x00,
        0x4f, 0x00, 0x00, 0x00, 0x21, 0x00, 0x00, 0x00, 0x05, 0x00, 0x00, 0x00, 0x48, 0x00, 0x05, 0x00,
        0x50, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x23, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x48, 0x00, 0x05, 0x00, 0x50, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x23, 0x00, 0x00, 0x00,
        0x10, 0x00, 0x00, 0x00, 0x47, 0x00, 0x04, 0x00, 0x51, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00,
        0x20, 0x00, 0x00, 0x00, 0x48, 0x00, 0x05, 0x00, 0x52, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x23, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x47, 0x00, 0x03, 0x00, 0x52, 0x00, 0x00, 0x00,
        0x02, 0x00, 0x00, 0x00, 0x47, 0x00, 0x04, 0x00, 0x54, 0x00, 0x00, 0x00, 0x22, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x47, 0x00, 0x04, 0x00, 0x54, 0x00, 0x00, 0x00, 0x21, 0x00, 0x00, 0x00,
        0x06, 0x00, 0x00, 0x00, 0x48, 0x00, 0x05, 0x00, 0x55, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x23, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x48, 0x00, 0x05, 0x00, 0x55, 0x00, 0x00, 0x00,
        0x01, 0x00, 0x00, 0x00, 0x23, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x48, 0x00, 0x05, 0x00,
        0x55, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x23, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
        0x47, 0x00, 0x04, 0x00, 0x56, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00,
        0x48, 0x00, 0x05, 0x00, 0x57, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x23, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x47, 0x00, 0x03, 0x00, 0x57, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00,
        0x47, 0x00, 0x04, 0x00, 0x59, 0x00, 0x00, 0x00, 0x22, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x47, 0x00, 0x04, 0x00, 0x59, 0x00, 0x00, 0x00, 0x21, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00,
        0x48, 0x00, 0x05, 0x00, 0x5a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x23, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x48, 0x00, 0x05, 0x00, 0x5a, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
        0x23, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x47, 0x00, 0x04, 0x00, 0x5b, 0x00, 0x00, 0x00,
        0x06, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x48, 0x00, 0x05, 0x00, 0x5c, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x23, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x47, 0x00, 0x03, 0x00,
        0x5c, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x47, 0x00, 0x04, 0x00, 0x5e, 0x00, 0x00, 0x00,
        0x22, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x47, 0x00, 0x04, 0x00, 0x5e, 0x00, 0x00, 0x00,
        0x21, 0x00, 0x00, 0x00, 0x08, 0x00, 0x00, 0x00, 0x13, 0x00, 0x02, 0x00, 0x02, 0x00, 0x00, 0x00,
        0x21, 0x00, 0x03, 0x00, 0x03, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x15, 0x00, 0x04, 0x00,
        0x06, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x17, 0x00, 0x04, 0x00,
        0x07, 0x00, 0x00, 0x00, 0x06, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x20, 0x00, 0x04, 0x00,
        0x08, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x15, 0x00, 0x04, 0x00,
        0x0a, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x17, 0x00, 0x04, 0x00,
        0x0b, 0x00, 0x00, 0x00, 0x0a, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x20, 0x00, 0x04, 0x00,
        0x0c, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x0b, 0x00, 0x00, 0x00, 0x3b, 0x00, 0x04, 0x00,
        0x0c, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x17, 0x00, 0x04, 0x00,
        0x0e, 0x00, 0x00, 0x00, 0x0a, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x16, 0x00, 0x03, 0x00,
        0x12, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x17, 0x00, 0x04, 0x00, 0x13, 0x00, 0x00, 0x00,
        0x12, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00, 0x20, 0x00, 0x04, 0x00, 0x14, 0x00, 0x00, 0x00,
        0x07, 0x00, 0x00, 0x00, 0x13, 0x00, 0x00, 0x00, 0x19, 0x00, 0x09, 0x00, 0x16, 0x00, 0x00, 0x00,
        0x12, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1b, 0x00, 0x03, 0x00,
        0x17, 0x00, 0x00, 0x00, 0x16, 0x00, 0x00, 0x00, 0x20, 0x00, 0x04, 0x00, 0x18, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x17, 0x00, 0x00, 0x00, 0x3b, 0x00, 0x04, 0x00, 0x18, 0x00, 0x00, 0x00,
        0x19, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x2b, 0x00, 0x04, 0x00, 0x06, 0x00, 0x00, 0x00,
        0x1c, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x17, 0x00, 0x04, 0x00, 0x20, 0x00, 0x00, 0x00,
        0x12, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0x20, 0x00, 0x04, 0x00, 0x21, 0x00, 0x00, 0x00,
        0x07, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00, 0x3b, 0x00, 0x04, 0x00, 0x18, 0x00, 0x00, 0x00,
        0x23, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3b, 0x00, 0x04, 0x00, 0x18, 0x00, 0x00, 0x00,
        0x2a, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x03, 0x00, 0x31, 0x00, 0x00, 0x00,
        0x20, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x03, 0x00, 0x32, 0x00, 0x00, 0x00, 0x31, 0x00, 0x00, 0x00,
        0x20, 0x00, 0x04, 0x00, 0x33, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x32, 0x00, 0x00, 0x00,
        0x3b, 0x00, 0x04, 0x00, 0x33, 0x00, 0x00, 0x00, 0x34, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00,
        0x20, 0x00, 0x04, 0x00, 0x35, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x20, 0x00, 0x00, 0x00,
        0x20, 0x00, 0x04, 0x00, 0x3b, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00, 0x12, 0x00, 0x00, 0x00,
        0x2b, 0x00, 0x04, 0x00, 0x12, 0x00, 0x00, 0x00, 0x3d, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x19, 0x00, 0x09, 0x00, 0x42, 0x00, 0x00, 0x00, 0x12, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00,
        0x04, 0x00, 0x00, 0x00, 0x20, 0x00, 0x04, 0x00, 0x43, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x42, 0x00, 0x00, 0x00, 0x3b, 0x00, 0x04, 0x00, 0x43, 0x00, 0x00, 0x00, 0x44, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x2b, 0x00, 0x04, 0x00, 0x0a, 0x00, 0x00, 0x00, 0x49, 0x00, 0x00, 0x00,
        0x01, 0x00, 0x00, 0x00, 0x2c, 0x00, 0x06, 0x00, 0x0b, 0x00, 0x00, 0x00, 0x4a, 0x00, 0x00, 0x00,
        0x49, 0x00, 0x00, 0x00, 0x49, 0x00, 0x00, 0x00, 0x49, 0x00, 0x00, 0x00, 0x3b, 0x00, 0x04, 0x00,
        0x18, 0x00, 0x00, 0x00, 0x4b, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x05, 0x00,
        0x4c, 0x00, 0x00, 0x00, 0x0a, 0x00, 0x00, 0x00, 0x0a, 0x00, 0x00, 0x00, 0x0a, 0x00, 0x00, 0x00,
        0x1e, 0x00, 0x03, 0x00, 0x4d, 0x00, 0x00, 0x00, 0x4c, 0x00, 0x00, 0x00, 0x20, 0x00, 0x04, 0x00,
        0x4e, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x4d, 0x00, 0x00, 0x00, 0x3b, 0x00, 0x04, 0x00,
        0x4e, 0x00, 0x00, 0x00, 0x4f, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x04, 0x00,
        0x50, 0x00, 0x00, 0x00, 0x13, 0x00, 0x00, 0x00, 0x13, 0x00, 0x00, 0x00, 0x1c, 0x00, 0x04, 0x00,
        0x51, 0x00, 0x00, 0x00, 0x50, 0x00, 0x00, 0x00, 0x49, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x03, 0x00,
        0x52, 0x00, 0x00, 0x00, 0x51, 0x00, 0x00, 0x00, 0x20, 0x00, 0x04, 0x00, 0x53, 0x00, 0x00, 0x00,
        0x02, 0x00, 0x00, 0x00, 0x52, 0x00, 0x00, 0x00, 0x3b, 0x00, 0x04, 0x00, 0x53, 0x00, 0x00, 0x00,
        0x54, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x05, 0x00, 0x55, 0x00, 0x00, 0x00,
        0x13, 0x00, 0x00, 0x00, 0x13, 0x00, 0x00, 0x00, 0x13, 0x00, 0x00, 0x00, 0x1c, 0x00, 0x04, 0x00, 
        0x56, 0x00, 0x00, 0x00, 0x55, 0x00, 0x00, 0x00, 0x49, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x03, 0x00,
        0x57, 0x00, 0x00, 0x00, 0x56, 0x00, 0x00, 0x00, 0x20, 0x00, 0x04, 0x00, 0x58, 0x00, 0x00, 0x00,
        0x02, 0x00, 0x00, 0x00, 0x57, 0x00, 0x00, 0x00, 0x3b, 0x00, 0x04, 0x00, 0x58, 0x00, 0x00, 0x00,
        0x59, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x04, 0x00, 0x5a, 0x00, 0x00, 0x00,
        0x13, 0x00, 0x00, 0x00, 0x13, 0x00, 0x00, 0x00, 0x1c, 0x00, 0x04, 0x00, 0x5b, 0x00, 0x00, 0x00,
        0x5a, 0x00, 0x00, 0x00, 0x49, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x03, 0x00, 0x5c, 0x00, 0x00, 0x00,
        0x5b, 0x00, 0x00, 0x00, 0x20, 0x00, 0x04, 0x00, 0x5d, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00,
        0x5c, 0x00, 0x00, 0x00, 0x3b, 0x00, 0x04, 0x00, 0x5d, 0x00, 0x00, 0x00, 0x5e, 0x00, 0x00, 0x00,
        0x02, 0x00, 0x00, 0x00, 0x36, 0x00, 0x05, 0x00, 0x02, 0x00, 0x00, 0x00, 0x04, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x03, 0x00, 0x00, 0x00, 0xf8, 0x00, 0x02, 0x00, 0x05, 0x00, 0x00, 0x00,
        0x3b, 0x00, 0x04, 0x00, 0x08, 0x00, 0x00, 0x00, 0x09, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00,
        0x3b, 0x00, 0x04, 0x00, 0x14, 0x00, 0x00, 0x00, 0x15, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00,
        0x3b, 0x00, 0x04, 0x00, 0x21, 0x00, 0x00, 0x00, 0x22, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00,
        0x3b, 0x00, 0x04, 0x00, 0x21, 0x00, 0x00, 0x00, 0x29, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00,
        0x3b, 0x00, 0x04, 0x00, 0x21, 0x00, 0x00, 0x00, 0x30, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00,
        0x3b, 0x00, 0x04, 0x00, 0x3b, 0x00, 0x00, 0x00, 0x3c, 0x00, 0x00, 0x00, 0x07, 0x00, 0x00, 0x00,
        0x3d, 0x00, 0x04, 0x00, 0x0b, 0x00, 0x00, 0x00, 0x0f, 0x00, 0x00, 0x00, 0x0d, 0x00, 0x00, 0x00,
        0x4f, 0x00, 0x07, 0x00, 0x0e, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x0f, 0x00, 0x00, 0x00,
        0x0f, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x7c, 0x00, 0x04, 0x00,
        0x07, 0x00, 0x00, 0x00, 0x11, 0x00, 0x00, 0x00, 0x10, 0x00, 0x00, 0x00, 0x3e, 0x00, 0x03, 0x00,
        0x09, 0x00, 0x00, 0x00, 0x11, 0x00, 0x00, 0x00, 0x3d, 0x00, 0x04, 0x00, 0x17, 0x00, 0x00, 0x00,
        0x1a, 0x00, 0x00, 0x00, 0x19, 0x00, 0x00, 0x00, 0x3d, 0x00, 0x04, 0x00, 0x07, 0x00, 0x00, 0x00,
        0x1b, 0x00, 0x00, 0x00, 0x09, 0x00, 0x00, 0x00, 0x64, 0x00, 0x04, 0x00, 0x16, 0x00, 0x00, 0x00,
        0x1d, 0x00, 0x00, 0x00, 0x1a, 0x00, 0x00, 0x00, 0x5f, 0x00, 0x07, 0x00, 0x13, 0x00, 0x00, 0x00,
        0x1e, 0x00, 0x00, 0x00, 0x1d, 0x00, 0x00, 0x00, 0x1b, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00,
        0x1c, 0x00, 0x00, 0x00, 0x4f, 0x00, 0x09, 0x00, 0x13, 0x00, 0x00, 0x00, 0x1f, 0x00, 0x00, 0x00,
        0x1e, 0x00, 0x00, 0x00, 0x1e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x3e, 0x00, 0x03, 0x00, 0x15, 0x00, 0x00, 0x00,
        0x1f, 0x00, 0x00, 0x00, 0x3d, 0x00, 0x04, 0x00, 0x17, 0x00, 0x00, 0x00, 0x24, 0x00, 0x00, 0x00,
        0x23, 0x00, 0x00, 0x00, 0x3d, 0x00, 0x04, 0x00, 0x07, 0x00, 0x00, 0x00, 0x25, 0x00, 0x00, 0x00,
        0x09, 0x00, 0x00, 0x00, 0x64, 0x00, 0x04, 0x00, 0x16, 0x00, 0x00, 0x00, 0x26, 0x00, 0x00, 0x00,
        0x24, 0x00, 0x00, 0x00, 0x5f, 0x00, 0x07, 0x00, 0x13, 0x00, 0x00, 0x00, 0x27, 0x00, 0x00, 0x00,
        0x26, 0x00, 0x00, 0x00, 0x25, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00,
        0x4f, 0x00, 0x08, 0x00, 0x20, 0x00, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x27, 0x00, 0x00, 0x00,
        0x27, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00,
        0x3e, 0x00, 0x03, 0x00, 0x22, 0x00, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x3d, 0x00, 0x04, 0x00,
        0x17, 0x00, 0x00, 0x00, 0x2b, 0x00, 0x00, 0x00, 0x2a, 0x00, 0x00, 0x00, 0x3d, 0x00, 0x04, 0x00,
        0x07, 0x00, 0x00, 0x00, 0x2c, 0x00, 0x00, 0x00, 0x09, 0x00, 0x00, 0x00, 0x64, 0x00, 0x04, 0x00,
        0x16, 0x00, 0x00, 0x00, 0x2d, 0x00, 0x00, 0x00, 0x2b, 0x00, 0x00, 0x00, 0x5f, 0x00, 0x07, 0x00,
        0x13, 0x00, 0x00, 0x00, 0x2e, 0x00, 0x00, 0x00, 0x2d, 0x00, 0x00, 0x00, 0x2c, 0x00, 0x00, 0x00,
        0x02, 0x00, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x4f, 0x00, 0x08, 0x00, 0x20, 0x00, 0x00, 0x00,
        0x2f, 0x00, 0x00, 0x00, 0x2e, 0x00, 0x00, 0x00, 0x2e, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00,
        0x01, 0x00, 0x00, 0x00, 0x02, 0x00, 0x00, 0x00, 0x3e, 0x00, 0x03, 0x00, 0x29, 0x00, 0x00, 0x00,
        0x2f, 0x00, 0x00, 0x00, 0x41, 0x00, 0x06, 0x00, 0x35, 0x00, 0x00, 0x00, 0x36, 0x00, 0x00, 0x00,
        0x34, 0x00, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x1c, 0x00, 0x00, 0x00, 0x3d, 0x00, 0x04, 0x00,
        0x20, 0x00, 0x00, 0x00, 0x37, 0x00, 0x00, 0x00, 0x36, 0x00, 0x00, 0x00, 0x3d, 0x00, 0x04, 0x00,
        0x20, 0x00, 0x00, 0x00, 0x38, 0x00, 0x00, 0x00, 0x29, 0x00, 0x00, 0x00, 0x83, 0x00, 0x05, 0x00,
        0x20, 0x00, 0x00, 0x00, 0x39, 0x00, 0x00, 0x00, 0x37, 0x00, 0x00, 0x00, 0x38, 0x00, 0x00, 0x00,
        0x0c, 0x00, 0x06, 0x00, 0x20, 0x00, 0x00, 0x00, 0x3a, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00,
        0x45, 0x00, 0x00, 0x00, 0x39, 0x00, 0x00, 0x00, 0x3e, 0x00, 0x03, 0x00, 0x30, 0x00, 0x00, 0x00,
        0x3a, 0x00, 0x00, 0x00, 0x3d, 0x00, 0x04, 0x00, 0x20, 0x00, 0x00, 0x00, 0x3e, 0x00, 0x00, 0x00,
        0x30, 0x00, 0x00, 0x00, 0x3d, 0x00, 0x04, 0x00, 0x20, 0x00, 0x00, 0x00, 0x3f, 0x00, 0x00, 0x00,
        0x22, 0x00, 0x00, 0x00, 0x94, 0x00, 0x05, 0x00, 0x12, 0x00, 0x00, 0x00, 0x40, 0x00, 0x00, 0x00,
        0x3e, 0x00, 0x00, 0x00, 0x3f, 0x00, 0x00, 0x00, 0x0c, 0x00, 0x07, 0x00, 0x12, 0x00, 0x00, 0x00,
        0x41, 0x00, 0x00, 0x00, 0x01, 0x00, 0x00, 0x00, 0x28, 0x00, 0x00, 0x00, 0x3d, 0x00, 0x00, 0x00,
        0x40, 0x00, 0x00, 0x00, 0x3e, 0x00, 0x03, 0x00, 0x3c, 0x00, 0x00, 0x00, 0x41, 0x00, 0x00, 0x00,
        0x3d, 0x00, 0x04, 0x00, 0x42, 0x00, 0x00, 0x00, 0x45, 0x00, 0x00, 0x00, 0x44, 0x00, 0x00, 0x00,
        0x3d, 0x00, 0x04, 0x00, 0x07, 0x00, 0x00, 0x00, 0x46, 0x00, 0x00, 0x00, 0x09, 0x00, 0x00, 0x00,
        0x3d, 0x00, 0x04, 0x00, 0x12, 0x00, 0x00, 0x00, 0x47, 0x00, 0x00, 0x00, 0x3c, 0x00, 0x00, 0x00,
        0x50, 0x00, 0x07, 0x00, 0x13, 0x00, 0x00, 0x00, 0x48, 0x00, 0x00, 0x00, 0x47, 0x00, 0x00, 0x00,
        0x47, 0x00, 0x00, 0x00, 0x47, 0x00, 0x00, 0x00, 0x47, 0x00, 0x00, 0x00, 0x63, 0x00, 0x04, 0x00,
        0x45, 0x00, 0x00, 0x00, 0x46, 0x00, 0x00, 0x00, 0x48, 0x00, 0x00, 0x00, 0xfd, 0x00, 0x01, 0x00,
        0x38, 0x00, 0x01, 0x00
    };

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    enum class MaxLights :
        size_t
    {
        Point       = 1024,
        Spot        = 1024,
        Direction   = 32
    };

    enum class PBRPassBindings :
        uint32_t
    {
        OutImage = 0,
        PositionAndMetallic,
        NormalAndRoughness,
        AlbedoAndBakedAO,
        Anisotropy,
        NumLights,
        PointLightsData,
        SpotLightsData,
        DirectionLightsData,
        CameraData
    };

    ////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////
    PBRPass::PBRPass(
        const PtrDevice&            ptr_device, 
        const PtrPhysicalDevice&    ptr_physical_deviec,
        uint32_t                    queue_family_index,
        const PtrDescriptorPool&    ptr_descriptor_pool,
        const ImageView&            position_and_metallic_image_view,
        const ImageView&            normal_and_roughness_image_view,
        const ImageView&            albedo_and_baked_AO_image_view,
        const ImageView&            anisotropy_image_view,
        const PtrSampler&           ptr_sampler
    )
    {
        _ptr_position_and_metallic_image_view   = &position_and_metallic_image_view;
        _ptr_normal_and_roughness_image_view    = &normal_and_roughness_image_view;
        _ptr_albedo_and_baked_AO_image_view     = &albedo_and_baked_AO_image_view;
        _ptr_anisotropy_image_view              = &anisotropy_image_view;
        
        _ptr_sampler = ptr_sampler;

        ShaderModule::Builder               build_shader;
        Buffer::Builder<PointLightData>     build_point_lights_data_buffer;
        Buffer::Builder<SpotLightData>      build_spot_lights_data_buffer;
        Buffer::Builder<DirectionLightData> build_direction_lights_data_buffer;
        Buffer::Builder<NumLights>          build_num_lights_buffer;
        Buffer::Builder<CameraData>         build_camera_data_buffer;

        DescriptorSetLayoutBindings bindings (ptr_device, 0);

        build_shader.setDevice(ptr_device);
        build_shader.setShaderCode(reinterpret_cast<const uint32_t*>(pbrpass_comp_spirv), sizeof(pbrpass_comp_spirv));
        build_shader.setShaderType(VK_SHADER_STAGE_COMPUTE_BIT);

        build_point_lights_data_buffer.setDevice(ptr_device);
        build_point_lights_data_buffer.setMemoryTypeIndex(ptr_physical_deviec->getMemoryTypeIndex(VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT));
        build_point_lights_data_buffer.setSize(util::enumCast(MaxLights::Point));
        build_point_lights_data_buffer.setUsage(VK_BUFFER_USAGE_UNIFORM_BUFFER_BIT);
        build_point_lights_data_buffer.addQueueFamily(queue_family_index);

        build_spot_lights_data_buffer.setDevice(ptr_device);
        build_spot_lights_data_buffer.setMemoryTypeIndex(ptr_physical_deviec->getMemoryTypeIndex(VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT));
        build_spot_lights_data_buffer.setSize(util::enumCast(MaxLights::Spot));
        build_spot_lights_data_buffer.setUsage(VK_BUFFER_USAGE_UNIFORM_BUFFER_BIT);
        build_spot_lights_data_buffer.addQueueFamily(queue_family_index);

        build_direction_lights_data_buffer.setDevice(ptr_device);
        build_direction_lights_data_buffer.setMemoryTypeIndex(ptr_physical_deviec->getMemoryTypeIndex(VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT));
        build_direction_lights_data_buffer.setSize(util::enumCast(MaxLights::Direction));
        build_direction_lights_data_buffer.setUsage(VK_BUFFER_USAGE_UNIFORM_BUFFER_BIT);
        build_direction_lights_data_buffer.addQueueFamily(queue_family_index);

        build_num_lights_buffer.setDevice(ptr_device);
        build_num_lights_buffer.setMemoryTypeIndex(ptr_physical_deviec->getMemoryTypeIndex(VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT));
        build_num_lights_buffer.setSize(1);
        build_num_lights_buffer.setUsage(VK_BUFFER_USAGE_UNIFORM_BUFFER_BIT);
        build_num_lights_buffer.addQueueFamily(queue_family_index);

        build_camera_data_buffer.setDevice(ptr_device);
        build_camera_data_buffer.setMemoryTypeIndex(ptr_physical_deviec->getMemoryTypeIndex(VK_MEMORY_PROPERTY_HOST_VISIBLE_BIT));
        build_camera_data_buffer.setSize(1);
        build_camera_data_buffer.setUsage(VK_BUFFER_USAGE_UNIFORM_BUFFER_BIT);
        build_camera_data_buffer.addQueueFamily(queue_family_index);

        bindings.addBinding(util::enumCast(PBRPassBindings::OutImage), VK_DESCRIPTOR_TYPE_STORAGE_IMAGE, VK_SHADER_STAGE_COMPUTE_BIT);
        bindings.addBinding(util::enumCast(PBRPassBindings::PositionAndMetallic), VK_DESCRIPTOR_TYPE_COMBINED_IMAGE_SAMPLER, VK_SHADER_STAGE_COMPUTE_BIT);
        bindings.addBinding(util::enumCast(PBRPassBindings::NormalAndRoughness), VK_DESCRIPTOR_TYPE_COMBINED_IMAGE_SAMPLER, VK_SHADER_STAGE_COMPUTE_BIT);
        bindings.addBinding(util::enumCast(PBRPassBindings::AlbedoAndBakedAO), VK_DESCRIPTOR_TYPE_COMBINED_IMAGE_SAMPLER, VK_SHADER_STAGE_COMPUTE_BIT);
        bindings.addBinding(util::enumCast(PBRPassBindings::Anisotropy), VK_DESCRIPTOR_TYPE_COMBINED_IMAGE_SAMPLER, VK_SHADER_STAGE_COMPUTE_BIT);
        bindings.addBinding(util::enumCast(PBRPassBindings::NumLights), VK_DESCRIPTOR_TYPE_UNIFORM_BUFFER, VK_SHADER_STAGE_COMPUTE_BIT);
        bindings.addBinding(util::enumCast(PBRPassBindings::PointLightsData), VK_DESCRIPTOR_TYPE_UNIFORM_BUFFER, VK_SHADER_STAGE_COMPUTE_BIT);
        bindings.addBinding(util::enumCast(PBRPassBindings::SpotLightsData), VK_DESCRIPTOR_TYPE_UNIFORM_BUFFER, VK_SHADER_STAGE_COMPUTE_BIT);
        bindings.addBinding(util::enumCast(PBRPassBindings::DirectionLightsData), VK_DESCRIPTOR_TYPE_UNIFORM_BUFFER, VK_SHADER_STAGE_COMPUTE_BIT);
        bindings.addBinding(util::enumCast(PBRPassBindings::CameraData), VK_DESCRIPTOR_TYPE_UNIFORM_BUFFER, VK_SHADER_STAGE_COMPUTE_BIT);

        _ptr_pipeline       = ComputePipeline::make(build_shader.build(), PipelineLayout::make(ptr_device, DescriptorSetLayout::make(move(bindings))));
        _ptr_descriptor_set = DescriptorSet::make(ptr_descriptor_pool, _ptr_pipeline->getPipelineLayout()->getDescriptorSetLayouts()[0]);

        _ptr_uniform_point_lights_data_buffer       = build_point_lights_data_buffer.buildPtr();
        _ptr_uniform_spot_lights_data_buffer        = build_spot_lights_data_buffer.buildPtr();
        _ptr_uniform_direction_lights_data_buffer   = build_direction_lights_data_buffer.buildPtr();
        _ptr_uniform_num_lights_buffer              = build_num_lights_buffer.buildPtr();
        
        _ptr_uniform_camera_data_buffer = build_camera_data_buffer.buildPtr();

        for (uint32_t binding {1} ; binding < 5; binding++) {
            _ptr_descriptor_set->writeImageView(
                *_ptr_images_views[binding - 1],
                VK_IMAGE_LAYOUT_SHADER_READ_ONLY_OPTIMAL,
                *_ptr_sampler,
                binding,
                VK_DESCRIPTOR_TYPE_COMBINED_IMAGE_SAMPLER
            );
        }

        _ptr_descriptor_set->writeBuffer(
            *_ptr_uniform_num_lights_buffer, 
            0, _ptr_uniform_num_lights_buffer->getSize(), 
            util::enumCast(PBRPassBindings::NumLights), VK_DESCRIPTOR_TYPE_UNIFORM_BUFFER
        );

        _ptr_descriptor_set->writeBuffer(
            *_ptr_uniform_point_lights_data_buffer, 
            0, _ptr_uniform_point_lights_data_buffer->getSize(), 
            util::enumCast(PBRPassBindings::PointLightsData), VK_DESCRIPTOR_TYPE_UNIFORM_BUFFER
        );

        _ptr_descriptor_set->writeBuffer(
            *_ptr_uniform_spot_lights_data_buffer, 
            0, _ptr_uniform_spot_lights_data_buffer->getSize(), 
            util::enumCast(PBRPassBindings::SpotLightsData), VK_DESCRIPTOR_TYPE_UNIFORM_BUFFER
        );

        _ptr_descriptor_set->writeBuffer(
            *_ptr_uniform_direction_lights_data_buffer,
            0, _ptr_uniform_direction_lights_data_buffer->getSize(),
            util::enumCast(PBRPassBindings::DirectionLightsData), VK_DESCRIPTOR_TYPE_UNIFORM_BUFFER
        );

        _ptr_descriptor_set->writeBuffer(
            *_ptr_uniform_camera_data_buffer, 
            0, _ptr_uniform_camera_data_buffer->getSize(), 
            util::enumCast(PBRPassBindings::CameraData), VK_DESCRIPTOR_TYPE_UNIFORM_BUFFER
        );
    }

    void PBRPass::draw(
        const CameraBase&               camera,
        const PtrCommandBuffer&         ptr_command_buffer,
        const ImageView&                out_image_view,
        const vector<Scene::PtrNode>    point_lights,
        const vector<Scene::PtrNode>    spot_lights,
        const vector<Scene::PtrNode>    direction_lights
    )
    {

        VkExtent3D  out_image_size  = out_image_view.getImage()->getImageInfo().image_extend;
        NumLights   num_lights;

        num_lights.point    = static_cast<uint>(min(util::enumCast(MaxLights::Point), point_lights.size()));
        num_lights.spot     = static_cast<uint>(min(util::enumCast(MaxLights::Spot), spot_lights.size()));
        num_lights.direct   = static_cast<uint>(min(util::enumCast(MaxLights::Direction), direction_lights.size()));

        vector<PointLightData>      point_lights_data       (num_lights.point);
        vector<SpotLightData>       spot_lights_data        (num_lights.spot);
        vector<DirectionLightData>  direction_lights_data   (num_lights.direct);

        CameraData camera_data = {
            .position = camera.getPosition()
        };

        for (size_t i{0}, size{point_lights.size()}; i < size; i++) {
            const PointLight& point_light = point_lights[i]->getComponent<PointLight>();

            point_lights_data[i].color_and_intensity    = Vec4<float>(point_light.getColor(), point_light.getIntensity());
            point_lights_data[i].position               = point_light.getPosition();
        }

        for (size_t i{0}, size{spot_lights.size()}; i < size; i++) {
            const SpotLight& spot_light = spot_lights[i]->getComponent<SpotLight>();

            spot_lights_data[i].color_and_intensity         = Vec4<float>(spot_light.getColor(), spot_light.getIntensity());
            spot_lights_data[i].position_and_inner_radius   = Vec4<float>(spot_light.getPosition(), spot_light.getInnerRadius());
            spot_lights_data[i].direction_and_outer_radius  = Vec4<float>(spot_light.getDirection(), spot_light.getOuterRadius());
        }

        for (size_t i{0}, size{direction_lights.size()}; i < size; i++) {
            const DirectionLight& direction_light = direction_lights[i]->getComponent<DirectionLight>();

            direction_lights_data[i].color_and_intensity    = Vec4<float>(direction_light.getColor(), direction_light.getIntensity());
            direction_lights_data[i].direction_on_light     = direction_light.getDirectionOnLight();
        }

        _ptr_uniform_num_lights_buffer->setData(&num_lights, 1);
        _ptr_uniform_camera_data_buffer->setData(&camera_data, 1);

        if (num_lights.point) {
            _ptr_uniform_point_lights_data_buffer->setData(point_lights_data);
        }

        if (num_lights.spot) {
            _ptr_uniform_spot_lights_data_buffer->setData(spot_lights_data);
        }

        if (num_lights.direct) {
            _ptr_uniform_direction_lights_data_buffer->setData(direction_lights_data);
        }

        _ptr_descriptor_set->writeImageView(
            out_image_view,
            VK_IMAGE_LAYOUT_GENERAL,
            util::enumCast(PBRPassBindings::OutImage), VK_DESCRIPTOR_TYPE_STORAGE_IMAGE
        );

        ptr_command_buffer->bindDescriptorSet(_ptr_pipeline, *_ptr_descriptor_set);
        ptr_command_buffer->dispatch(out_image_size.width, out_image_size.height, 1);
    }

    PtrComputePipeline& PBRPass::getPipeline() noexcept
    {
        return _ptr_pipeline;
    }

    const PtrComputePipeline& PBRPass::getPipeline() const noexcept
    {
        return _ptr_pipeline;
    }

    PtrPBRPass PBRPass::make(
        const PtrDevice&            ptr_device, 
        const PtrPhysicalDevice&    ptr_physical_deviec,
        uint32_t                    queue_family_index,
        const PtrDescriptorPool&    ptr_descriptor_pool,
        const ImageView&            position_and_metallic_image_view,
        const ImageView&            normal_and_roughness_image_view,
        const ImageView&            albedo_and_baked_AO_image_view,
        const ImageView&            anisotropy_image_view,
        const PtrSampler&           ptr_sampler
    )
    {
        return make_unique<PBRPass>(
            ptr_device, 
            ptr_physical_deviec,
            queue_family_index,
            ptr_descriptor_pool,
            position_and_metallic_image_view,
            normal_and_roughness_image_view,
            albedo_and_baked_AO_image_view,
            anisotropy_image_view,
            ptr_sampler
        );
    }
}
